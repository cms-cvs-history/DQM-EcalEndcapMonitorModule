process ECALDQM = {

     module ecalUncalibHit = ecalFixedAlphaBetaFitUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalFixedAlphaBetaFitUncalibRecHit.cfi"

     replace ecalUncalibHit.MinAmplBarrel = 12.
     replace ecalUncalibHit.MinAmplEndcap = 16.

#     module ecalUncalibHit = ecalWeightUncalibRecHit from "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"

     replace ecalUncalibHit.EBdigiCollection = ecalDigis:ebDigis
     replace ecalUncalibHit.EEdigiCollection = ecalDigis:eeDigis

include "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"

     replace ecalRecHit.EBuncalibRecHitCollection = ecalUncalibHit:EcalUncalibRecHitsEB
     replace ecalRecHit.EEuncalibRecHitCollection = ecalUncalibHit:EcalUncalibRecHitsEE

include "DQM/EcalEndcapMonitorModule/data/EcalEndcapMonitorModule.cfi"

     replace ecalEndcapMonitorModule.mergeRuns = true

     replace ecalEndcapMonitorModule.EEDigiCollection = ecalDigis:eeDigis

     replace ecalEndcapMonitorModule.runType = 3 # MTCC/PHYSICS

include "DQM/EcalEndcapMonitorTasks/data/EcalEndcapMonitorTasks.cfi"

include "DQM/EcalEndcapMonitorTasks/data/mergeRuns.cff"

include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"
include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"

include "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis.cff"
include "Geometry/EcalMapping/data/EcalMapping.cfi"

     replace ecalTriggerPrimitiveDigis.Label = "ecalDigis"
     replace ecalTriggerPrimitiveDigis.InstanceEB = "ebDigis"
     replace ecalTriggerPrimitiveDigis.InstanceEE = "eeDigis"

     module ecalTriggerPrimitiveDigis2 = ecalTriggerPrimitiveDigis from "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis.cfi"

     replace ecalTriggerPrimitiveDigis2.Label = "ecalDigis"
     replace ecalTriggerPrimitiveDigis2.InstanceEB = "ebDigis"
     replace ecalTriggerPrimitiveDigis2.InstanceEE = "eeDigis"

     replace ecalEndcapTriggerTowerTask.EcalTrigPrimDigiCollectionReal = ecalTriggerPrimitiveDigis2

     replace ecalEndcapMonitorModule.EcalTrigPrimDigiCollection = ecalTriggerPrimitiveDigis2

     replace ecalEndcapOccupancyTask.EEDigiCollection = ecalDigis:eeDigis
     replace ecalEndcapOccupancyTask.EcalTrigPrimDigiCollection = ecalTriggerPrimitiveDigis
     replace ecalEndcapPedestalOnlineTask.EEDigiCollection = ecalDigis:eeDigis

include "DQM/EcalEndcapMonitorClient/data/EcalEndcapMonitorClient.cfi"

     replace ecalEndcapMonitorClient.maskFile = "maskfile-EE.dat"
     replace ecalEndcapMonitorClient.mergeRuns = true
     replace ecalEndcapMonitorClient.location = "H4"
     replace ecalEndcapMonitorClient.baseHtmlDir = "."
     replace ecalEndcapMonitorClient.enabledClients = { "Integrity",
                                                        "Occupancy",
                                                        "PedestalOnline",
                                                        "Cosmic",
                                                        "Timing",
                                                        "TriggerTower",
                                                        "Cluster",
                                                        "Summary" }

     module preScaler = Prescaler{ int32 prescaleFactor = 1 }

     module dqmInfoEE = DQMEventInfo{
       untracked string subSystemFolder = "EcalEndcap"
     }

     module dqmSaverEE = DQMFileSaver{
       untracked string convention = "Online"
       untracked string dirName = "."
       untracked string fileName = "EcalEndcap"
     }

include "RecoEcal/EgammaClusterProducers/data/ecalClusteringSequence.cff"

#     replace islandBasicClusters.IslandBarrelSeedThr = 0.150 # 0.500
#     replace islandBasicClusters.IslandEndcapSeedThr = 0.150 # 0.180

#     replace hybridSuperClusters.HybridBarrelSeedThr = 0.150 # 1.000
#     replace hybridSuperClusters.step = 1      # 17
#     replace hybridSuperClusters.eseed = 0.150 # 0.350

#     replace islandSuperClusters.seedTransverseEnergyThreshold = 0.150 # 1.000

     sequence ecalDataSequence = { preScaler,
                                         ecalUncalibHit,
                                         ecalRecHit,
                                         ecalTriggerPrimitiveDigis,
                                         ecalTriggerPrimitiveDigis2,
                                         islandBasicClusters,
                                         islandSuperClusters,
                                         hybridSuperClusters }

     sequence ecalEndcapMonitorSequence = { ecalEndcapMonitorModule,
                                            dqmInfoEE,
                                            ecalEndcapMonitorClient,
                                            dqmSaverEE }

     path p = { ecalDataSequence, ecalEndcapMonitorSequence }

     endpath q = { ecalEndcapDefaultTasksSequence, ecalEndcapCosmicTask, ecalEndcapClusterTask }

#     untracked PSet maxEvents = {untracked int32 input = 150}
     untracked PSet maxEvents = {untracked int32 input = 300}
     source = PoolSource{
#---
       untracked vstring fileNames = { '/store/users/dellaric/data/5E883D60-4B98-DC11-BD17-000423D6A6F4.root' }
#---
#       untracked vstring fileNames = { '/store/users/dellaric/data/muon_50GeV_allECAL_gain200.root' }
#---
     }

     es_source = EcalTrivialConditionRetriever{
       untracked double adcToGeVEBConstant = 0.035
       untracked double adcToGeVEEConstant = 0.060
#       untracked double adcToGeVEBConstant = 0.00875 # 0.035
#       untracked double adcToGeVEEConstant = 0.015   # 0.060
       untracked vdouble amplWeights = { -0.333, -0.333, -0.333,
                                          0.000,  0.000,  1.000,
                                          0.000,  0.000,  0.000,  0.000 }
       untracked vdouble pedWeights  = {  0.333,  0.333,  0.333,
                                          0.000,  0.000,  0.000,
                                          0.000,  0.000,  0.000,  0.000 }
       untracked vdouble jittWeights = {  0.041,  0.041,  0.041,
                                          0.000,  1.325, -0.050,
                                         -0.504, -0.502, -0.390,  0.000 }
     }

include "CalibCalorimetry/EcalLaserCorrection/data/ecalLaserCorrectionService.cfi"

     service = MessageLogger{
       untracked vstring destinations = { "cout" }
       untracked vstring categories = { "EcalEndcapMonitorModule" }
       untracked PSet cout = {
         untracked string threshold = "WARNING"
         untracked PSet default                        = { untracked int32 limit = 0 }
         untracked PSet EcalEndcapMonitorModule        = { untracked int32 limit = 0 }
         untracked bool noTimeStamps = true
         untracked bool noLineBreaks = true
       }
     }

include "DQMServices/Core/data/DQM.cfg"

     replace DQM.collectorHost = ""

}
